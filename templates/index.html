<!DOCTYPE html>
<html>
<head>
    <title>VAPT Modular Scanner</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="console-container">
        <h1>VAPT Modular Security Scanner</h1>
        <form id="scan-form">
            <input type="text" name="target" id="target" placeholder="Target (e.g., 192.168.1.1 or http://testsite.com)" required>
            <div class="modules">
                <label><input type="checkbox" name="scan_type" value="nmap" checked> Nmap Scan</label>
                <label><input type="checkbox" name="scan_type" value="zap"> OWASP ZAP Scan</label>
                <!-- Add more scanners here as needed -->
            </div>
            <button type="submit">Run Scan</button>
        </form>
        <div id="output-area" class="output-area">
            <div class="scanner-console" id="nmap-console">
                <div class="console-title">NMAP Output</div>
                <div class="console-body" id="nmap-output"></div>
            </div>
            <div class="scanner-console" id="zap-console">
                <div class="console-title">OWASP ZAP Output</div>
                <div class="console-body" id="zap-output"></div>
            </div>
            <!-- Add more scanner consoles here as you expand modules -->
        </div>
        
        <script>
        document.getElementById('scan-form').onsubmit = async function(e){
            e.preventDefault();
            // Clear previous outputs
            document.getElementById('nmap-output').innerText = '';
            document.getElementById('zap-output').innerText = '';
            // Collect targets/modules
            let target = document.getElementById('target').value;
            let scanTypes = Array.from(document.querySelectorAll('input[name="scan_type"]:checked')).map(cb => cb.value);
        
            // Run all selected scanners in parallel
            for (let scanType of scanTypes) {
                let outputDiv = document.getElementById(scanType + '-output');
                outputDiv.innerText = 'Scan started...';
                fetch('/scan', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({scan_type: scanType, target: target})
                })
                .then(r => r.json())
                .then(result => {
                    outputDiv.innerText = formatScanResult(result, scanType);
                })
                .catch(e => {
                    outputDiv.innerText = `Error: ${e}`;
                });
            }
        }
        
        function formatScanResult(result, scanType) {
            if (result.error) return `[ERROR] ${result.error}`;
            if (scanType === "nmap") {
                let out = "";
                if (result.results) {
                    result.results.forEach(host => {
                        out += `\n[${host.host}] (${host.status})\n`;
                        host.open_ports.forEach(p =>
                            out += `   [${p.port}] ${p.service} ${p.version}\n`);
                    });
                }
                return out || "[No hosts found]";
            }
            if (scanType === "zap") {
                if (!result.results || !result.results.alerts) return "[No alerts found]";
                let out = "";
                result.results.alerts.forEach(alert =>
                    out += `[${alert.risk}] ${alert.alert} (${alert.cweid ? "CWE-" + alert.cweid : "No CWE"})\n   URL: ${alert.url}\n   Evidence: ${alert.evidence || "N/A"}\n`
                );
                return out || "[No alerts found]";
            }
            return JSON.stringify(result, null, 2);
        }
        </script>        
</body>
</html>
